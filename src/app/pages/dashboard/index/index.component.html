<!-- Dashboard Content -->
<div *ngIf="dashboardData && dashboardData.total_courses > 0 && !isLoading">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">Welcome back, {{ userService.getFullName() }}</h1>
    <p class="dashboard-subtitle">Here's what's happening with your learning journey today</p>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-header">
        <div>
          <div class="stat-value">{{ getActiveCoursesCount() }}</div>
          <div class="stat-label">Active Courses</div>
        </div>
        <div class="stat-icon primary">
          <i class="fas fa-book-open"></i>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <div>
          <div class="stat-value">{{ getCompletedCoursesCount() }}</div>
          <div class="stat-label">Completed Courses</div>
        </div>
        <div class="stat-icon success">
          <i class="fas fa-check-circle"></i>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <div>
          <div class="stat-value">{{ getAverageProgress() }}%</div>
          <div class="stat-label">Average Progress</div>
        </div>
        <div class="stat-icon warning">
          <i class="fas fa-chart-line"></i>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <div>
          <div class="stat-value">{{ getCertificatesEarned() }}</div>
          <div class="stat-label">Certificates Earned</div>
        </div>
        <div class="stat-icon primary">
          <i class="fas fa-certificate"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div class="two-column-layout">
    <!-- Recent Activity -->
    <div class="activity-card">
      <div class="section-header">
        <h2 class="section-title">Recent Activity</h2>
      </div>

      <div *ngIf="recentActivities.length === 0" class="empty-state">
        <p>No recent activity yet. Start learning to see your progress here.</p>
      </div>

      <div *ngFor="let activity of recentActivities" class="activity-item">
        <div class="activity-icon" [ngClass]="activity.type">
          <i [class]="activity.icon"></i>
        </div>
        <div class="activity-info">
          <div class="activity-title">{{ activity.title }}</div>
          <div class="activity-subtitle">{{ activity.subtitle }}</div>
        </div>
        <div class="activity-time">{{ activity.time }}</div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <div class="section-header">
        <h2 class="section-title">Quick Actions</h2>
      </div>

      <button class="action-btn" (click)="navigateToCatalog()">
        <i class="fas fa-search"></i>
        <span>Browse Courses</span>
      </button>

      <button class="action-btn" (click)="navigateToEnrollments()">
        <i class="fas fa-graduation-cap"></i>
        <span>My Enrollments</span>
      </button>

      <button class="action-btn">
        <i class="fas fa-certificate"></i>
        <span>View Certificates</span>
      </button>

      <button class="action-btn">
        <i class="fas fa-chart-bar"></i>
        <span>Progress Reports</span>
      </button>

      <button class="action-btn">
        <i class="fas fa-calendar-alt"></i>
        <span>Study Schedule</span>
      </button>
    </div>
  </div>

  <!-- Your Enrolled Courses (Includes both in-progress and not started) -->
  <div class="courses-section" *ngIf="getActiveEnrollments().length > 0">
    <div class="section-header">
      <h2 class="section-title">Your Enrolled Courses</h2>
      <button class="view-all-btn" (click)="navigateToEnrollments()">View All</button>
    </div>

    <div class="courses-grid">
      <div *ngFor="let enrollment of getActiveEnrollments().slice(0, 3)"
           class="course-card"
           (click)="continueCourseLearning(enrollment)">
        <div class="course-banner">
          <img *ngIf="enrollment.course.image && enrollment.course.image.public_url"
               [src]="enrollment.course.image.public_url"
               [alt]="enrollment.course.title">
          <i *ngIf="!enrollment.course.image || !enrollment.course.image.public_url" class="fas fa-book"></i>

          <!-- Offline Badge -->
          <div *ngIf="isCourseDownloaded(enrollment.course_id)" class="offline-badge">
            <i class="fas fa-download"></i>
            <span>Offline</span>
          </div>
        </div>
        <div class="course-content">
          <h3 class="course-title">{{ enrollment.course.title }}</h3>
          <p class="course-description">{{ enrollment.course.description || 'Start your learning journey' }}</p>

          <div class="course-meta">
            <div class="course-meta-item">
              <i class="fas fa-book"></i>
              <span>{{ enrollment.total_modules }} modules</span>
            </div>
            <div class="course-meta-item">
              <i class="fas fa-signal"></i>
              <span>{{ enrollment.course.level }}</span>
            </div>
            <div class="course-meta-item" *ngIf="enrollment.course.duration">
              <i class="fas fa-clock"></i>
              <span>{{ enrollment.course.duration }}h</span>
            </div>
          </div>

          <div class="course-meta">
            <div class="course-meta-item">
              <i class="fas fa-tag"></i>
              <span>{{ enrollment.course.category }}</span>
            </div>
            <!-- Offline Status -->
            <div class="course-meta-item offline-stat" *ngIf="isCourseDownloaded(enrollment.course_id)">
              <i class="fas fa-check-circle"></i>
              <span>Available offline</span>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="course-actions">
            <!-- Download Button: Show only if NOT downloaded -->
            <button
              *ngIf="!isCourseDownloaded(enrollment.course_id)"
              class="btn-download-small"
              [disabled]="isDownloading(enrollment.course_id)"
              (click)="downloadCourseForOffline(enrollment.course_id, $event)">
              <i [class]="isDownloading(enrollment.course_id) ? 'fas fa-spinner fa-spin' : 'fas fa-download'"></i>
              <span class="download-text">{{ isDownloading(enrollment.course_id) ? 'Downloading...' : 'Download' }}</span>
            </button>

            <!-- Sync Button: Show only if downloaded AND online -->
            <button
              *ngIf="isCourseDownloaded(enrollment.course_id) && isOnline()"
              class="btn-sync-small"
              [disabled]="isSyncing(enrollment.course_id)"
              (click)="syncCourseProgress(enrollment, $event)">
              <i [class]="isSyncing(enrollment.course_id) ? 'fas fa-spinner fa-spin' : 'fas fa-sync-alt'"></i>
              <span>{{ isSyncing(enrollment.course_id) ? 'Syncing...' : 'Sync Progress' }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Latest Available Courses -->
  <div class="courses-section" *ngIf="availableCourses && availableCourses.courses.length > 0">
    <div class="section-header">
      <h2 class="section-title">Latest Courses</h2>
      <button class="view-all-btn" (click)="navigateToCatalog()">Explore More</button>
    </div>

    <div class="courses-grid">
      <div *ngFor="let course of availableCourses.courses"
           class="course-card"
           (click)="viewCourseDetails(course.id)">
        <div class="course-banner">
          <img *ngIf="course.image && course.image.public_url"
               [src]="course.image.public_url"
               [alt]="course.title">
          <i *ngIf="!course.image || !course.image.public_url" class="fas fa-graduation-cap"></i>
        </div>
        <div class="course-content">
          <h3 class="course-title">{{ course.title }}</h3>
          <p class="course-description">{{ course.description || 'Expand your knowledge with this course' }}</p>

          <div class="course-meta">
            <div class="course-meta-item">
              <i class="fas fa-book"></i>
              <span>{{ course.module_count }} modules</span>
            </div>
            <div class="course-meta-item">
              <i class="fas fa-signal"></i>
              <span>{{ course.level }}</span>
            </div>
            <div class="course-meta-item" *ngIf="course.duration">
              <i class="fas fa-clock"></i>
              <span>{{ course.duration }}h</span>
            </div>
          </div>

          <div class="course-meta">
            <div class="course-meta-item">
              <i class="fas fa-tag"></i>
              <span>{{ course.category }}</span>
            </div>
            <div class="course-meta-item" *ngIf="course.enrollment_count">
              <i class="fas fa-users"></i>
              <span>{{ course.enrollment_count }} enrolled</span>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="course-actions">
            <button
              class="btn-enroll-small"
              (click)="enrollInCourse(course.id, $event)">
              <i class="fas fa-graduation-cap"></i>
              <span>Enroll Now</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Completed Courses -->
  <div class="courses-section" *ngIf="getCompletedEnrollments().length > 0">
    <div class="section-header">
      <h2 class="section-title">Completed Courses</h2>
      <button class="view-all-btn" (click)="navigateToEnrollments()">View All</button>
    </div>

    <div class="courses-grid">
      <div *ngFor="let enrollment of getCompletedEnrollments().slice(0, 3)"
           class="course-card"
           (click)="viewCourseDetails(enrollment.course_id)">
        <div class="course-banner">
          <img *ngIf="enrollment.course.image && enrollment.course.image.public_url"
               [src]="enrollment.course.image.public_url"
               [alt]="enrollment.course.title">
          <i *ngIf="!enrollment.course.image || !enrollment.course.image.public_url" class="fas fa-check-circle"></i>

          <!-- Offline Badge -->
          <div *ngIf="isCourseDownloaded(enrollment.course_id)" class="offline-badge">
            <i class="fas fa-download"></i>
            <span>Offline</span>
          </div>
        </div>
        <div class="course-content">
          <h3 class="course-title">{{ enrollment.course.title }}</h3>
          <p class="course-description">{{ enrollment.course.description || 'Course completed!' }}</p>

          <div class="course-meta">
            <div class="course-meta-item">
              <i class="fas fa-certificate"></i>
              <span>Completed on {{ enrollment.completed_at | date:'mediumDate' }}</span>
            </div>
          </div>

          <div class="course-meta">
            <div class="course-meta-item">
              <i class="fas fa-check-circle"></i>
              <span>100% Complete</span>
            </div>
            <div class="course-meta-item">
              <i class="fas fa-book"></i>
              <span>{{ enrollment.total_modules }} modules</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="dashboardData && dashboardData.total_courses === 0 && !isLoading" class="empty-dashboard">
  <i class="fas fa-graduation-cap"></i>
  <h2>Start Your Learning Journey</h2>
  <p>You have not enrolled in any courses yet. Browse our catalog to get started.</p>
  <button class="action-btn primary" (click)="navigateToCatalog()">Browse Courses</button>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="loading-state">
  <i class="fas fa-spinner fa-spin"></i>
  <p>Loading your dashboard...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !isLoading" class="error-state">
  <i class="fas fa-exclamation-circle"></i>
  <h2>Something went wrong</h2>
  <p>{{ error }}</p>
  <button class="action-btn primary" (click)="loadDashboard()">Try Again</button>
</div>
